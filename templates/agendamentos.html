{% extends "base.html" %}
{% block title %}Agendamentos{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-3xl font-bold text-gray-900"><i class="fas fa-calendar-check text-indigo-500 mr-3"></i>{% if session.role == 'operator' %}Meus Agendamentos{% else %}Dados Agendados{% endif %}</h1>
        <p class="text-gray-600">Lista de contatos com retorno agendado.</p>
    </div>
</div>

<div class="bg-white rounded-xl shadow-md overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data Agendada</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Entrevistado / Telefone</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Projeto</th>
                {% if session.role != 'operator' %}<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Operador</th>{% endif %}
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Ações</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for lead in leads %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4">
                    <div class="text-sm font-semibold text-gray-900">{{ lead.scheduled_at.strftime('%d/%m/%Y %H:%M') if lead.scheduled_at else 'N/A' }}</div>
                    {% if lead.scheduled_at %}
                    <div class="text-xs text-gray-500">
                        {% set delta = lead.scheduled_at - get_current_time() %}
                        {% if delta.days >= 0 %} Faltam {{ delta.days }} dias {% else %} Atrasado {% endif %}
                    </div>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm font-medium text-gray-900">{{ lead.name }}</div>
                    <div class="text-sm text-gray-500">{{ lead.phone }}</div>
                </td>
                <td class="px-6 py-4 text-sm">{{ lead.project_name or 'N/A' }}</td>
                {% if session.role != 'operator' %}<td class="px-6 py-4 text-sm">{{ lead.operator or 'N/A' }}</td>{% endif %}
                <td class="px-6 py-4 text-center">
                    <a href="{{ url_for('edit_lead', lead_id=lead.id) }}" class="btn btn-secondary text-xs !py-1 !px-3">Ver/Editar</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                    <i class="fas fa-calendar-times fa-3x text-gray-300 mb-2"></i><br>Nenhum agendamento encontrado.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}